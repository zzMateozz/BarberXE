{"version":3,"sources":["../../src/commands/MigrationCreateCommand.ts"],"names":[],"mappings":";;;;AAAA,0DAAwB;AACxB,wDAAuB;AAEvB,6DAAyD;AACzD,qDAA+C;AAC/C,iDAA6C;AAE7C;;GAEG;AACH,MAAa,sBAAsB;IAAnC;QACI,YAAO,GAAG,yBAAyB,CAAA;QACnC,aAAQ,GAAG,+BAA+B,CAAA;IAqG9C,CAAC;IAnGG,OAAO,CAAC,IAAgB;QACpB,OAAO,IAAI;aACN,UAAU,CAAC,MAAM,EAAE;YAChB,IAAI,EAAE,QAAQ;YACd,QAAQ,EAAE,4BAA4B;YACtC,YAAY,EAAE,IAAI;SACrB,CAAC;aACD,MAAM,CAAC,GAAG,EAAE;YACT,KAAK,EAAE,UAAU;YACjB,IAAI,EAAE,SAAS;YACf,OAAO,EAAE,KAAK;YACd,QAAQ,EACJ,+DAA+D;SACtE,CAAC;aACD,MAAM,CAAC,GAAG,EAAE;YACT,KAAK,EAAE,WAAW;YAClB,IAAI,EAAE,QAAQ;YACd,OAAO,EAAE,KAAK;YACd,QAAQ,EAAE,yCAAyC;SACtD,CAAC,CAAA;IACV,CAAC;IAED,KAAK,CAAC,OAAO,CAAC,IAA6C;QACvD,IAAI,CAAC;YACD,MAAM,SAAS,GAAG,2BAAY,CAAC,YAAY,CAAC,IAAI,CAAC,SAAS,CAAC,CAAA;YAC3D,MAAM,SAAS,GAAG,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC;gBACvC,CAAC,CAAC,IAAI,CAAC,IAAI;gBACX,CAAC,CAAC,cAAI,CAAC,OAAO,CAAC,OAAO,CAAC,GAAG,EAAE,EAAE,IAAI,CAAC,IAAI,CAAC,CAAA;YAC5C,MAAM,QAAQ,GAAG,cAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,CAAA;YACzC,MAAM,QAAQ,GACV,cAAI,CAAC,OAAO,CAAC,SAAS,CAAC,GAAG,GAAG,GAAG,SAAS,GAAG,GAAG,GAAG,QAAQ,CAAA;YAE9D,MAAM,WAAW,GAAG,IAAI,CAAC,QAAQ;gBAC7B,CAAC,CAAC,sBAAsB,CAAC,qBAAqB,CACxC,QAAQ,EACR,SAAS,CACZ;gBACH,CAAC,CAAC,sBAAsB,CAAC,WAAW,CAAC,QAAQ,EAAE,SAAS,CAAC,CAAA;YAE7D,MAAM,2BAAY,CAAC,UAAU,CACzB,QAAQ,GAAG,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,EAC1C,WAAW,CACd,CAAA;YACD,OAAO,CAAC,GAAG,CACP,aAAa,eAAI,CAAC,IAAI,CAClB,QAAQ,GAAG,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,CAC7C,mCAAmC,CACvC,CAAA;QACL,CAAC;QAAC,OAAO,GAAG,EAAE,CAAC;YACX,6BAAa,CAAC,SAAS,CAAC,kCAAkC,EAAE,GAAG,CAAC,CAAA;YAChE,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,CAAA;QACnB,CAAC;IACL,CAAC;IAED,4EAA4E;IAC5E,2BAA2B;IAC3B,4EAA4E;IAE5E;;OAEG;IACO,MAAM,CAAC,WAAW,CAAC,IAAY,EAAE,SAAiB;QACxD,OAAO;;eAEA,IAAA,uBAAS,EACZ,IAAI,EACJ,IAAI,CACP,GAAG,SAAS;;;;;;;;;CASpB,CAAA;IACG,CAAC;IAED;;OAEG;IACO,MAAM,CAAC,qBAAqB,CAClC,IAAY,EACZ,SAAiB;QAEjB,OAAO;;yBAEU,IAAA,uBAAS,EAAC,IAAI,EAAE,IAAI,CAAC,GAAG,SAAS;;;;;;;;;CASzD,CAAA;IACG,CAAC;CACJ;AAvGD,wDAuGC","file":"MigrationCreateCommand.js","sourcesContent":["import ansi from \"ansis\"\r\nimport path from \"path\"\r\nimport yargs from \"yargs\"\r\nimport { PlatformTools } from \"../platform/PlatformTools\"\r\nimport { camelCase } from \"../util/StringUtils\"\r\nimport { CommandUtils } from \"./CommandUtils\"\r\n\r\n/**\r\n * Creates a new migration file.\r\n */\r\nexport class MigrationCreateCommand implements yargs.CommandModule {\r\n    command = \"migration:create <path>\"\r\n    describe = \"Creates a new migration file.\"\r\n\r\n    builder(args: yargs.Argv) {\r\n        return args\r\n            .positional(\"path\", {\r\n                type: \"string\",\r\n                describe: \"Path of the migration file\",\r\n                demandOption: true,\r\n            })\r\n            .option(\"o\", {\r\n                alias: \"outputJs\",\r\n                type: \"boolean\",\r\n                default: false,\r\n                describe:\r\n                    \"Generate a migration file on Javascript instead of Typescript\",\r\n            })\r\n            .option(\"t\", {\r\n                alias: \"timestamp\",\r\n                type: \"number\",\r\n                default: false,\r\n                describe: \"Custom timestamp for the migration name\",\r\n            })\r\n    }\r\n\r\n    async handler(args: yargs.Arguments<any & { path: string }>) {\r\n        try {\r\n            const timestamp = CommandUtils.getTimestamp(args.timestamp)\r\n            const inputPath = args.path.startsWith(\"/\")\r\n                ? args.path\r\n                : path.resolve(process.cwd(), args.path)\r\n            const filename = path.basename(inputPath)\r\n            const fullPath =\r\n                path.dirname(inputPath) + \"/\" + timestamp + \"-\" + filename\r\n\r\n            const fileContent = args.outputJs\r\n                ? MigrationCreateCommand.getJavascriptTemplate(\r\n                      filename,\r\n                      timestamp,\r\n                  )\r\n                : MigrationCreateCommand.getTemplate(filename, timestamp)\r\n\r\n            await CommandUtils.createFile(\r\n                fullPath + (args.outputJs ? \".js\" : \".ts\"),\r\n                fileContent,\r\n            )\r\n            console.log(\r\n                `Migration ${ansi.blue(\r\n                    fullPath + (args.outputJs ? \".js\" : \".ts\"),\r\n                )} has been generated successfully.`,\r\n            )\r\n        } catch (err) {\r\n            PlatformTools.logCmdErr(\"Error during migration creation:\", err)\r\n            process.exit(1)\r\n        }\r\n    }\r\n\r\n    // -------------------------------------------------------------------------\r\n    // Protected Static Methods\r\n    // -------------------------------------------------------------------------\r\n\r\n    /**\r\n     * Gets contents of the migration file.\r\n     */\r\n    protected static getTemplate(name: string, timestamp: number): string {\r\n        return `import { MigrationInterface, QueryRunner } from \"typeorm\";\r\n\r\nexport class ${camelCase(\r\n            name,\r\n            true,\r\n        )}${timestamp} implements MigrationInterface {\r\n\r\n    public async up(queryRunner: QueryRunner): Promise<void> {\r\n    }\r\n\r\n    public async down(queryRunner: QueryRunner): Promise<void> {\r\n    }\r\n\r\n}\r\n`\r\n    }\r\n\r\n    /**\r\n     * Gets contents of the migration file in Javascript.\r\n     */\r\n    protected static getJavascriptTemplate(\r\n        name: string,\r\n        timestamp: number,\r\n    ): string {\r\n        return `const { MigrationInterface, QueryRunner } = require(\"typeorm\");\r\n\r\nmodule.exports = class ${camelCase(name, true)}${timestamp} {\r\n\r\n    async up(queryRunner) {\r\n    }\r\n\r\n    async down(queryRunner) {\r\n    }\r\n\r\n}\r\n`\r\n    }\r\n}\r\n"],"sourceRoot":".."}