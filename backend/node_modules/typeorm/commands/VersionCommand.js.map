{"version":3,"sources":["../../src/commands/VersionCommand.ts"],"names":[],"mappings":";;;AACA,iDAAoC;AAEpC;;GAEG;AACH,MAAa,cAAc;IAA3B;QACI,YAAO,GAAG,SAAS,CAAA;QACnB,aAAQ,GAAG,2CAA2C,CAAA;IAwD1D,CAAC;IAtDG,KAAK,CAAC,OAAO;QACT,MAAM,YAAY,GAAG,MAAM,cAAc,CAAC,cAAc,CACpD,oBAAoB,CACvB,CAAA;QACD,MAAM,YAAY,GAAG,YAAY,CAAC,KAAK,CAAC,iBAAiB,CAAC,CAAA;QAC1D,MAAM,eAAe,GAAG,CACpB,YAAY,IAAI,YAAY,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CACzD;aACI,OAAO,CAAC,aAAa,EAAE,EAAE,CAAC;aAC1B,IAAI,EAAE,CAAA;QAEX,MAAM,aAAa,GAAG,MAAM,cAAc,CAAC,cAAc,CACrD,uBAAuB,CAC1B,CAAA;QACD,MAAM,aAAa,GAAG,aAAa,CAAC,KAAK,CAAC,iBAAiB,CAAC,CAAA;QAC5D,MAAM,gBAAgB,GAAG,CACrB,aAAa,IAAI,aAAa,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,aAAa,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAC5D;aACI,OAAO,CAAC,aAAa,EAAE,EAAE,CAAC;aAC1B,IAAI,EAAE,CAAA;QAEX,IAAI,eAAe,EAAE,CAAC;YAClB,OAAO,CAAC,GAAG,CAAC,0BAA0B,EAAE,eAAe,CAAC,CAAA;QAC5D,CAAC;aAAM,CAAC;YACJ,OAAO,CAAC,GAAG,CAAC,uCAAuC,CAAC,CAAA;QACxD,CAAC;QACD,IAAI,gBAAgB,EAAE,CAAC;YACnB,OAAO,CAAC,GAAG,CAAC,mCAAmC,EAAE,gBAAgB,CAAC,CAAA;QACtE,CAAC;aAAM,CAAC;YACJ,OAAO,CAAC,GAAG,CAAC,gCAAgC,CAAC,CAAA;QACjD,CAAC;QAED,IACI,eAAe;YACf,gBAAgB;YAChB,eAAe,KAAK,gBAAgB,EACtC,CAAC;YACC,OAAO,CAAC,GAAG,CACP,0FAA0F;gBACtF,mEAAmE,CAC1E,CAAA;QACL,CAAC;IACL,CAAC;IAES,MAAM,CAAC,cAAc,CAAC,OAAe;QAC3C,OAAO,IAAI,OAAO,CAAS,CAAC,EAAE,EAAE,IAAI,EAAE,EAAE;YACpC,IAAA,oBAAI,EAAC,OAAO,EAAE,CAAC,KAAU,EAAE,MAAW,EAAE,MAAW,EAAE,EAAE;gBACnD,IAAI,MAAM;oBAAE,OAAO,EAAE,CAAC,MAAM,CAAC,CAAA;gBAC7B,IAAI,MAAM;oBAAE,OAAO,EAAE,CAAC,MAAM,CAAC,CAAA;gBAC7B,IAAI,KAAK;oBAAE,OAAO,IAAI,CAAC,KAAK,CAAC,CAAA;gBAC7B,EAAE,CAAC,EAAE,CAAC,CAAA;YACV,CAAC,CAAC,CAAA;QACN,CAAC,CAAC,CAAA;IACN,CAAC;CACJ;AA1DD,wCA0DC","file":"VersionCommand.js","sourcesContent":["import * as yargs from \"yargs\"\r\nimport { exec } from \"child_process\"\r\n\r\n/**\r\n * Shows typeorm version.\r\n */\r\nexport class VersionCommand implements yargs.CommandModule {\r\n    command = \"version\"\r\n    describe = \"Prints TypeORM version this project uses.\"\r\n\r\n    async handler() {\r\n        const localNpmList = await VersionCommand.executeCommand(\r\n            \"npm list --depth=0\",\r\n        )\r\n        const localMatches = localNpmList.match(/ typeorm@(.*)\\n/)\r\n        const localNpmVersion = (\r\n            localMatches && localMatches[1] ? localMatches[1] : \"\"\r\n        )\r\n            .replace(/\"invalid\"/gi, \"\")\r\n            .trim()\r\n\r\n        const globalNpmList = await VersionCommand.executeCommand(\r\n            \"npm list -g --depth=0\",\r\n        )\r\n        const globalMatches = globalNpmList.match(/ typeorm@(.*)\\n/)\r\n        const globalNpmVersion = (\r\n            globalMatches && globalMatches[1] ? globalMatches[1] : \"\"\r\n        )\r\n            .replace(/\"invalid\"/gi, \"\")\r\n            .trim()\r\n\r\n        if (localNpmVersion) {\r\n            console.log(\"Local installed version:\", localNpmVersion)\r\n        } else {\r\n            console.log(\"No local installed TypeORM was found.\")\r\n        }\r\n        if (globalNpmVersion) {\r\n            console.log(\"Global installed TypeORM version:\", globalNpmVersion)\r\n        } else {\r\n            console.log(\"No global installed was found.\")\r\n        }\r\n\r\n        if (\r\n            localNpmVersion &&\r\n            globalNpmVersion &&\r\n            localNpmVersion !== globalNpmVersion\r\n        ) {\r\n            console.log(\r\n                \"To avoid issues with CLI please make sure your global and local TypeORM versions match, \" +\r\n                    \"or you are using locally installed TypeORM instead of global one.\",\r\n            )\r\n        }\r\n    }\r\n\r\n    protected static executeCommand(command: string) {\r\n        return new Promise<string>((ok, fail) => {\r\n            exec(command, (error: any, stdout: any, stderr: any) => {\r\n                if (stdout) return ok(stdout)\r\n                if (stderr) return ok(stderr)\r\n                if (error) return fail(error)\r\n                ok(\"\")\r\n            })\r\n        })\r\n    }\r\n}\r\n"],"sourceRoot":".."}