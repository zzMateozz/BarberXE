{"version":3,"sources":["../../src/cache/QueryResultCacheFactory.ts"],"names":[],"mappings":";;;AAAA,mEAA+D;AAC/D,6DAAyD;AAGzD,wDAAoD;AAEpD;;GAEG;AACH,MAAa,uBAAuB;IAChC,4EAA4E;IAC5E,cAAc;IACd,4EAA4E;IAE5E,YAAsB,UAAsB;QAAtB,eAAU,GAAV,UAAU,CAAY;IAAG,CAAC;IAEhD,4EAA4E;IAC5E,iBAAiB;IACjB,4EAA4E;IAE5E;;OAEG;IACH,MAAM;QACF,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,KAAK;YAC9B,MAAM,IAAI,2BAAY,CAClB,uKAAuK,CAC1K,CAAA;QAEL,MAAM,KAAK,GAAQ,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,KAAK,CAAA;QAEhD,IAAI,KAAK,CAAC,QAAQ,IAAI,OAAO,KAAK,CAAC,QAAQ,KAAK,UAAU,EAAE,CAAC;YACzD,OAAO,KAAK,CAAC,QAAQ,CAAC,IAAI,CAAC,UAAU,CAAC,CAAA;QAC1C,CAAC;QAED,IACI,KAAK,CAAC,IAAI,KAAK,OAAO;YACtB,KAAK,CAAC,IAAI,KAAK,SAAS;YACxB,KAAK,CAAC,IAAI,KAAK,iBAAiB,EAClC,CAAC;YACC,OAAO,IAAI,6CAAqB,CAAC,IAAI,CAAC,UAAU,EAAE,KAAK,CAAC,IAAI,CAAC,CAAA;QACjE,CAAC;aAAM,CAAC;YACJ,OAAO,IAAI,uCAAkB,CAAC,IAAI,CAAC,UAAU,CAAC,CAAA;QAClD,CAAC;IACL,CAAC;CACJ;AApCD,0DAoCC","file":"QueryResultCacheFactory.js","sourcesContent":["import { RedisQueryResultCache } from \"./RedisQueryResultCache\"\r\nimport { DbQueryResultCache } from \"./DbQueryResultCache\"\r\nimport { QueryResultCache } from \"./QueryResultCache\"\r\nimport { DataSource } from \"../data-source/DataSource\"\r\nimport { TypeORMError } from \"../error/TypeORMError\"\r\n\r\n/**\r\n * Caches query result into Redis database.\r\n */\r\nexport class QueryResultCacheFactory {\r\n    // -------------------------------------------------------------------------\r\n    // Constructor\r\n    // -------------------------------------------------------------------------\r\n\r\n    constructor(protected connection: DataSource) {}\r\n\r\n    // -------------------------------------------------------------------------\r\n    // Public Methods\r\n    // -------------------------------------------------------------------------\r\n\r\n    /**\r\n     * Creates a new query result cache based on connection options.\r\n     */\r\n    create(): QueryResultCache {\r\n        if (!this.connection.options.cache)\r\n            throw new TypeORMError(\r\n                `To use cache you need to enable it in connection options by setting cache: true or providing some caching options. Example: { host: ..., username: ..., cache: true }`,\r\n            )\r\n\r\n        const cache: any = this.connection.options.cache\r\n\r\n        if (cache.provider && typeof cache.provider === \"function\") {\r\n            return cache.provider(this.connection)\r\n        }\r\n\r\n        if (\r\n            cache.type === \"redis\" ||\r\n            cache.type === \"ioredis\" ||\r\n            cache.type === \"ioredis/cluster\"\r\n        ) {\r\n            return new RedisQueryResultCache(this.connection, cache.type)\r\n        } else {\r\n            return new DbQueryResultCache(this.connection)\r\n        }\r\n    }\r\n}\r\n"],"sourceRoot":".."}