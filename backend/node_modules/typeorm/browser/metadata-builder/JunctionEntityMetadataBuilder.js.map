{"version":3,"sources":["../browser/src/metadata-builder/JunctionEntityMetadataBuilder.ts"],"names":[],"mappings":"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","file":"JunctionEntityMetadataBuilder.js","sourcesContent":["import { ColumnMetadata } from \"../metadata/ColumnMetadata\"\r\nimport { DataSource } from \"../data-source/DataSource\"\r\nimport { EntityMetadata } from \"../metadata/EntityMetadata\"\r\nimport { ForeignKeyMetadata } from \"../metadata/ForeignKeyMetadata\"\r\nimport { IndexMetadata } from \"../metadata/IndexMetadata\"\r\nimport { JoinTableMetadataArgs } from \"../metadata-args/JoinTableMetadataArgs\"\r\nimport { RelationMetadata } from \"../metadata/RelationMetadata\"\r\nimport { TypeORMError } from \"../error\"\r\nimport { DriverUtils } from \"../driver/DriverUtils\"\r\n\r\n/**\r\n * Creates EntityMetadata for junction tables.\r\n * Junction tables are tables generated by many-to-many relations.\r\n */\r\nexport class JunctionEntityMetadataBuilder {\r\n    // -------------------------------------------------------------------------\r\n    // Constructor\r\n    // -------------------------------------------------------------------------\r\n\r\n    constructor(private connection: DataSource) {}\r\n\r\n    // -------------------------------------------------------------------------\r\n    // Public Methods\r\n    // -------------------------------------------------------------------------\r\n\r\n    /**\r\n     * Builds EntityMetadata for the junction of the given many-to-many relation.\r\n     */\r\n    build(\r\n        relation: RelationMetadata,\r\n        joinTable: JoinTableMetadataArgs,\r\n    ): EntityMetadata {\r\n        const referencedColumns = this.collectReferencedColumns(\r\n            relation,\r\n            joinTable,\r\n        )\r\n        const inverseReferencedColumns = this.collectInverseReferencedColumns(\r\n            relation,\r\n            joinTable,\r\n        )\r\n\r\n        const joinTableName =\r\n            joinTable.name ||\r\n            this.connection.namingStrategy.joinTableName(\r\n                relation.entityMetadata.tableNameWithoutPrefix,\r\n                relation.inverseEntityMetadata.tableNameWithoutPrefix,\r\n                relation.propertyPath,\r\n                relation.inverseRelation\r\n                    ? relation.inverseRelation.propertyName\r\n                    : \"\",\r\n            )\r\n\r\n        const entityMetadata = new EntityMetadata({\r\n            connection: this.connection,\r\n            args: {\r\n                target: \"\",\r\n                name: joinTableName,\r\n                type: \"junction\",\r\n                database:\r\n                    joinTable.database || relation.entityMetadata.database,\r\n                schema: joinTable.schema || relation.entityMetadata.schema,\r\n                synchronize: joinTable.synchronize,\r\n            },\r\n        })\r\n        entityMetadata.build()\r\n\r\n        // create original side junction columns\r\n        const junctionColumns = referencedColumns.map((referencedColumn) => {\r\n            const joinColumn = joinTable.joinColumns\r\n                ? joinTable.joinColumns.find((joinColumnArgs) => {\r\n                      return (\r\n                          (!joinColumnArgs.referencedColumnName ||\r\n                              joinColumnArgs.referencedColumnName ===\r\n                                  referencedColumn.propertyName) &&\r\n                          !!joinColumnArgs.name\r\n                      )\r\n                  })\r\n                : undefined\r\n            const columnName =\r\n                joinColumn && joinColumn.name\r\n                    ? joinColumn.name\r\n                    : this.connection.namingStrategy.joinTableColumnName(\r\n                          relation.entityMetadata.tableNameWithoutPrefix,\r\n                          referencedColumn.propertyName,\r\n                          referencedColumn.databaseName,\r\n                      )\r\n\r\n            return new ColumnMetadata({\r\n                connection: this.connection,\r\n                entityMetadata: entityMetadata,\r\n                referencedColumn: referencedColumn,\r\n                args: {\r\n                    target: \"\",\r\n                    mode: \"virtual\",\r\n                    propertyName: columnName,\r\n                    options: {\r\n                        name: columnName,\r\n                        length:\r\n                            !referencedColumn.length &&\r\n                            (DriverUtils.isMySQLFamily(\r\n                                this.connection.driver,\r\n                            ) ||\r\n                                this.connection.driver.options.type ===\r\n                                    \"aurora-mysql\") &&\r\n                            // some versions of mariadb support the column type and should not try to provide the length property\r\n                            this.connection.driver.normalizeType(\r\n                                referencedColumn,\r\n                            ) !== \"uuid\" &&\r\n                            (referencedColumn.generationStrategy === \"uuid\" ||\r\n                                referencedColumn.type === \"uuid\")\r\n                                ? \"36\"\r\n                                : referencedColumn.length, // fix https://github.com/typeorm/typeorm/issues/3604\r\n                        width: referencedColumn.width,\r\n                        type: referencedColumn.type,\r\n                        precision: referencedColumn.precision,\r\n                        scale: referencedColumn.scale,\r\n                        charset: referencedColumn.charset,\r\n                        collation: referencedColumn.collation,\r\n                        zerofill: referencedColumn.zerofill,\r\n                        unsigned: referencedColumn.zerofill\r\n                            ? true\r\n                            : referencedColumn.unsigned,\r\n                        enum: referencedColumn.enum,\r\n                        enumName: referencedColumn.enumName,\r\n                        foreignKeyConstraintName:\r\n                            joinColumn?.foreignKeyConstraintName,\r\n                        nullable: false,\r\n                        primary: true,\r\n                    },\r\n                },\r\n            })\r\n        })\r\n\r\n        // create inverse side junction columns\r\n        const inverseJunctionColumns = inverseReferencedColumns.map(\r\n            (inverseReferencedColumn) => {\r\n                const joinColumn = joinTable.inverseJoinColumns\r\n                    ? joinTable.inverseJoinColumns.find((joinColumnArgs) => {\r\n                          return (\r\n                              (!joinColumnArgs.referencedColumnName ||\r\n                                  joinColumnArgs.referencedColumnName ===\r\n                                      inverseReferencedColumn.propertyName) &&\r\n                              !!joinColumnArgs.name\r\n                          )\r\n                      })\r\n                    : undefined\r\n                const columnName =\r\n                    joinColumn && joinColumn.name\r\n                        ? joinColumn.name\r\n                        : this.connection.namingStrategy.joinTableInverseColumnName(\r\n                              relation.inverseEntityMetadata\r\n                                  .tableNameWithoutPrefix,\r\n                              inverseReferencedColumn.propertyName,\r\n                              inverseReferencedColumn.databaseName,\r\n                          )\r\n\r\n                return new ColumnMetadata({\r\n                    connection: this.connection,\r\n                    entityMetadata: entityMetadata,\r\n                    referencedColumn: inverseReferencedColumn,\r\n                    args: {\r\n                        target: \"\",\r\n                        mode: \"virtual\",\r\n                        propertyName: columnName,\r\n                        options: {\r\n                            length:\r\n                                !inverseReferencedColumn.length &&\r\n                                (DriverUtils.isMySQLFamily(\r\n                                    this.connection.driver,\r\n                                ) ||\r\n                                    this.connection.driver.options.type ===\r\n                                        \"aurora-mysql\") &&\r\n                                // some versions of mariadb support the column type and should not try to provide the length property\r\n                                this.connection.driver.normalizeType(\r\n                                    inverseReferencedColumn,\r\n                                ) !== \"uuid\" &&\r\n                                (inverseReferencedColumn.generationStrategy ===\r\n                                    \"uuid\" ||\r\n                                    inverseReferencedColumn.type === \"uuid\")\r\n                                    ? \"36\"\r\n                                    : inverseReferencedColumn.length, // fix https://github.com/typeorm/typeorm/issues/3604\r\n                            width: inverseReferencedColumn.width, // fix https://github.com/typeorm/typeorm/issues/6442\r\n                            type: inverseReferencedColumn.type,\r\n                            precision: inverseReferencedColumn.precision,\r\n                            scale: inverseReferencedColumn.scale,\r\n                            charset: inverseReferencedColumn.charset,\r\n                            collation: inverseReferencedColumn.collation,\r\n                            zerofill: inverseReferencedColumn.zerofill,\r\n                            unsigned: inverseReferencedColumn.zerofill\r\n                                ? true\r\n                                : inverseReferencedColumn.unsigned,\r\n                            enum: inverseReferencedColumn.enum,\r\n                            enumName: inverseReferencedColumn.enumName,\r\n                            foreignKeyConstraintName:\r\n                                joinColumn?.foreignKeyConstraintName,\r\n                            name: columnName,\r\n                            nullable: false,\r\n                            primary: true,\r\n                        },\r\n                    },\r\n                })\r\n            },\r\n        )\r\n\r\n        this.changeDuplicatedColumnNames(\r\n            junctionColumns,\r\n            inverseJunctionColumns,\r\n        )\r\n\r\n        // set junction table columns\r\n        entityMetadata.ownerColumns = junctionColumns\r\n        entityMetadata.inverseColumns = inverseJunctionColumns\r\n        entityMetadata.ownColumns = [\r\n            ...junctionColumns,\r\n            ...inverseJunctionColumns,\r\n        ]\r\n        entityMetadata.ownColumns.forEach(\r\n            (column) => (column.relationMetadata = relation),\r\n        )\r\n\r\n        // create junction table foreign keys\r\n        // Note: UPDATE CASCADE clause is not supported in Oracle.\r\n        // Note: UPDATE/DELETE CASCADE clauses are not supported in Spanner.\r\n        entityMetadata.foreignKeys = relation.createForeignKeyConstraints\r\n            ? [\r\n                  new ForeignKeyMetadata({\r\n                      entityMetadata: entityMetadata,\r\n                      referencedEntityMetadata: relation.entityMetadata,\r\n                      columns: junctionColumns,\r\n                      referencedColumns: referencedColumns,\r\n                      name: junctionColumns[0]?.foreignKeyConstraintName,\r\n                      onDelete:\r\n                          this.connection.driver.options.type === \"spanner\"\r\n                              ? \"NO ACTION\"\r\n                              : relation.onDelete || \"CASCADE\",\r\n                      onUpdate:\r\n                          this.connection.driver.options.type === \"oracle\" ||\r\n                          this.connection.driver.options.type === \"spanner\"\r\n                              ? \"NO ACTION\"\r\n                              : relation.onUpdate || \"CASCADE\",\r\n                  }),\r\n                  new ForeignKeyMetadata({\r\n                      entityMetadata: entityMetadata,\r\n                      referencedEntityMetadata: relation.inverseEntityMetadata,\r\n                      columns: inverseJunctionColumns,\r\n                      referencedColumns: inverseReferencedColumns,\r\n                      name: inverseJunctionColumns[0]?.foreignKeyConstraintName,\r\n                      onDelete:\r\n                          this.connection.driver.options.type === \"spanner\"\r\n                              ? \"NO ACTION\"\r\n                              : relation.inverseRelation\r\n                              ? relation.inverseRelation.onDelete\r\n                              : \"CASCADE\",\r\n                      onUpdate:\r\n                          this.connection.driver.options.type === \"oracle\" ||\r\n                          this.connection.driver.options.type === \"spanner\"\r\n                              ? \"NO ACTION\"\r\n                              : relation.inverseRelation\r\n                              ? relation.inverseRelation.onUpdate\r\n                              : \"CASCADE\",\r\n                  }),\r\n              ]\r\n            : []\r\n\r\n        // create junction table indices\r\n        entityMetadata.ownIndices = [\r\n            new IndexMetadata({\r\n                entityMetadata: entityMetadata,\r\n                columns: junctionColumns,\r\n                args: {\r\n                    target: entityMetadata.target,\r\n                    synchronize: true,\r\n                },\r\n            }),\r\n\r\n            new IndexMetadata({\r\n                entityMetadata: entityMetadata,\r\n                columns: inverseJunctionColumns,\r\n                args: {\r\n                    target: entityMetadata.target,\r\n                    synchronize: true,\r\n                },\r\n            }),\r\n        ]\r\n\r\n        // finally return entity metadata\r\n        return entityMetadata\r\n    }\r\n\r\n    // -------------------------------------------------------------------------\r\n    // Protected Methods\r\n    // -------------------------------------------------------------------------\r\n\r\n    /**\r\n     * Collects referenced columns from the given join column args.\r\n     */\r\n    protected collectReferencedColumns(\r\n        relation: RelationMetadata,\r\n        joinTable: JoinTableMetadataArgs,\r\n    ): ColumnMetadata[] {\r\n        const hasAnyReferencedColumnName = joinTable.joinColumns\r\n            ? joinTable.joinColumns.find(\r\n                  (joinColumn) => !!joinColumn.referencedColumnName,\r\n              )\r\n            : false\r\n        if (\r\n            !joinTable.joinColumns ||\r\n            (joinTable.joinColumns && !hasAnyReferencedColumnName)\r\n        ) {\r\n            return relation.entityMetadata.columns.filter(\r\n                (column) => column.isPrimary,\r\n            )\r\n        } else {\r\n            return joinTable.joinColumns.map((joinColumn) => {\r\n                const referencedColumn = relation.entityMetadata.columns.find(\r\n                    (column) =>\r\n                        column.propertyName === joinColumn.referencedColumnName,\r\n                )\r\n                if (!referencedColumn)\r\n                    throw new TypeORMError(\r\n                        `Referenced column ${joinColumn.referencedColumnName} was not found in entity ${relation.entityMetadata.name}`,\r\n                    )\r\n\r\n                return referencedColumn\r\n            })\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Collects inverse referenced columns from the given join column args.\r\n     */\r\n    protected collectInverseReferencedColumns(\r\n        relation: RelationMetadata,\r\n        joinTable: JoinTableMetadataArgs,\r\n    ): ColumnMetadata[] {\r\n        const hasInverseJoinColumns = !!joinTable.inverseJoinColumns\r\n        const hasAnyInverseReferencedColumnName = hasInverseJoinColumns\r\n            ? joinTable.inverseJoinColumns!.find(\r\n                  (joinColumn) => !!joinColumn.referencedColumnName,\r\n              )\r\n            : false\r\n        if (\r\n            !hasInverseJoinColumns ||\r\n            (hasInverseJoinColumns && !hasAnyInverseReferencedColumnName)\r\n        ) {\r\n            return relation.inverseEntityMetadata.primaryColumns\r\n        } else {\r\n            return joinTable.inverseJoinColumns!.map((joinColumn) => {\r\n                const referencedColumn =\r\n                    relation.inverseEntityMetadata.ownColumns.find(\r\n                        (column) =>\r\n                            column.propertyName ===\r\n                            joinColumn.referencedColumnName,\r\n                    )\r\n                if (!referencedColumn)\r\n                    throw new TypeORMError(\r\n                        `Referenced column ${joinColumn.referencedColumnName} was not found in entity ${relation.inverseEntityMetadata.name}`,\r\n                    )\r\n\r\n                return referencedColumn\r\n            })\r\n        }\r\n    }\r\n\r\n    protected changeDuplicatedColumnNames(\r\n        junctionColumns: ColumnMetadata[],\r\n        inverseJunctionColumns: ColumnMetadata[],\r\n    ) {\r\n        junctionColumns.forEach((junctionColumn) => {\r\n            inverseJunctionColumns.forEach((inverseJunctionColumn) => {\r\n                if (\r\n                    junctionColumn.givenDatabaseName ===\r\n                    inverseJunctionColumn.givenDatabaseName\r\n                ) {\r\n                    const junctionColumnName =\r\n                        this.connection.namingStrategy.joinTableColumnDuplicationPrefix(\r\n                            junctionColumn.propertyName,\r\n                            1,\r\n                        )\r\n                    junctionColumn.propertyName = junctionColumnName\r\n                    junctionColumn.givenDatabaseName = junctionColumnName\r\n\r\n                    const inverseJunctionColumnName =\r\n                        this.connection.namingStrategy.joinTableColumnDuplicationPrefix(\r\n                            inverseJunctionColumn.propertyName,\r\n                            2,\r\n                        )\r\n                    inverseJunctionColumn.propertyName =\r\n                        inverseJunctionColumnName\r\n                    inverseJunctionColumn.givenDatabaseName =\r\n                        inverseJunctionColumnName\r\n                }\r\n            })\r\n        })\r\n    }\r\n}\r\n"],"sourceRoot":".."}